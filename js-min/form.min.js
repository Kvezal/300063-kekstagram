"use strict";!function(){var e={chrome:"grayscale",sepia:"sepia",marvin:"invert",phobos:"blur",heat:"brightness"},t=function(e){window.utils.isEscEvent(e,i)},n=function(){window.utils.showElement(a),document.addEventListener("keydown",t),s.addEventListener("keydown",l)},i=function(){document.removeEventListener("keydown",t),s.removeEventListener("keydown",l),r.reset(),h(k,100),N=F.offsetWidth,window.initializeScale(T,W);var e=S.querySelector("#upload-effect-none");window.initializeFilter(e,E),window.utils.hiddenElement(a)},o=function(){var e=w.value.split(" "),t=e.length;return!e.some(function(n,i){for(var o=i+1;o<t;o++)if(e[o]===n)return f(w),w.setCustomValidity("Есть повторяющиеся хэш-теги"),!0;return w.setCustomValidity(""),!1})},r=document.querySelector("#upload-select-image");r.addEventListener("submit",function(e){e.preventDefault(),m.value.length>=30&&w.validity.valid&&o()&&(w.removeEventListener("change",c),m.removeEventListener("change",c),window.backend.save(new FormData(r),i,window.backend.displayError))});r.querySelector("#upload-file").addEventListener("change",function(){n()});var a=r.querySelector(".upload-overlay"),l=function(e){window.utils.isEnterEvent(e,i)},s=a.querySelector(".upload-form-cancel");s.addEventListener("click",function(){i()});var d=function(){document.removeEventListener("keydown",t)},u=function(){document.addEventListener("keydown",t)},c=function(e){e.target.validity.valid||o()?e.target.style.outline="":e.target.style.outline="2px solid #ff0000"},f=function(e){e.style.outline="2px solid #ff0000",e.addEventListener("change",c)},v=function(e){e.target.validity.valid||f(e.target)},w=r.querySelector(".upload-form-hashtags");w.addEventListener("focus",d),w.addEventListener("focusout",u),w.addEventListener("invalid",v);var m=r.querySelector(".upload-form-description");m.addEventListener("focus",d),m.addEventListener("focusout",u),m.addEventListener("invalid",v);var y=function(){k.classList.contains(b)&&k.classList.remove(b)},p=function(t,n){var i;switch(t){case"phobos":i=e[t]+"("+3*n+"px)";break;case"heat":i=e[t]+"("+3*n+")";break;case"none":i="",window.utils.hiddenElement(C);break;default:i=e[t]+"("+1*n+")"}k.style.filter=i,N=F.offsetWidth},E=function(e){q=e.value,y(),b="effect-"+q,window.utils.showElement(C),p(q,1),k.classList.add(b),window.initializeScale(T,W)},L=function(e,t,n){return e>=n?n:e<=t?t:e},h=function(e,t){e.style.transform="scale("+t/100+")",100===t&&(e.style.transform="")},g=function(e){var t,n=+z.value.replace(/%/,""),i=+z.step.replace(/%/,""),o=+z.min.replace(/%/,""),r=+z.max.replace(/%/,"");switch(e.textContent){case"–":t=n-i;break;case"+":t=n+i}t=L(t,o,r),h(k,t),z.value=t+"%"},S=document.querySelector(".upload-effect"),k=S.querySelector(".effect-image-preview"),q="none",b="effect-"+q;S.addEventListener("click",function(e){"INPUT"===e.target.tagName&&"radio"===e.target.type&&window.initializeFilter(e.target,E),e.target.classList.contains("upload-resize-controls-button")&&window.initializeScale(e.target,g)}),S.addEventListener("keydown",function(e){if(e.keyCode===window.utils.ENTER_KEYCODE&&"LABEL"===e.target.tagName){var t=S.querySelector("#"+e.target.htmlFor);"radio"===t.type&&window.initializeFilter(t,E)}});var z=S.querySelector(".upload-resize-controls-value"),x=function(e,t,n){var i=t/n;return e.style.width=100*i+"%",i},D=function(e,t){var n=F.offsetWidth;e.style.left=t+"px",e.offsetLeft<0&&(t=0),e.offsetLeft>n&&(t=n),e.style.left=t+"px";var i=x(X,t,n);p(q,i)},C=S.querySelector(".upload-effect-level"),F=C.querySelector(".upload-effect-level-line"),N=F.offsetWidth,W=function(e){D(e,N)},X=C.querySelector(".upload-effect-level-val"),T=F.querySelector(".upload-effect-level-pin");T.addEventListener("mousedown",function(e){e.preventDefault();var t=e.clientX,n=function(n){e.preventDefault();var i=t-n.clientX;t=n.clientX,N=T.offsetLeft-i,window.initializeScale(T,W)},i=function(t){e.preventDefault(),S.removeEventListener("mousemove",n),S.removeEventListener("mouseup",i)};S.addEventListener("mousemove",n),S.addEventListener("mouseup",i)})}();